{% extends 'base.html'%}

{% block title %} Pesquisar Contratos {% endblock %}

{% block content %}
<script>
  $(document).ready(function () {
    $('.container').removeClass('container');
  });
  setGenPasswordToFields(['id_{{user_form.password1.name}}', 'id_{{user_form.password2.name}}']);
</script>


<div class="content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">Filtros de Contratos</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-12 pr-1">
            <div class="form-group">
              <form id="myForm" method="POST" enctype="multipart/form-data"
                data-urlclasses="{% url 'users:classes_choices_ajax' %}"> {% csrf_token %}

                <div class="clearfix"></div>
                <!-- <div class="labelandform">
										<p><label>Selecione a cadeia que você deseja pesquisar:</label></p>
										<select class="custom-select chosen-select" id="select_form">
											<option id="" value="" selected>--------</option>
											{% for chain in chains_to_select %}
												<option value="{{ chain.id }}">{{ chain.name }}</option>
											{% endfor %}
										</select>
                  </div> -->
                <div class="row">
                  <div class="labelandform col-md-6">
                    <p><label>Selecione a Escola:</label></p>
                    <select class="custom-select chosen-select" id="select_form_school">
                      <option id="" value="0">--------</option>
                      {% for school in schools %}
                      <option value="{{ school.school_id }}" {% if school.school_id == query.selected_school %} selected {% endif %}>{{ school.school_name }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="labelandform col-md-6">
                    <p><label>Selecione a Turma:</label></p>
                    <select class="custom-select chosen-select" id="select_form_class">
                      <option id="" value="0">--------</option>
                    </select>
                  </div>
                </div>
                <div class="row">
                  <div class="labelandform col-md-6">
                    <p><label>Selecione o Filtro:</label></p>
                    <select class="custom-select chosen-select" id="select_form_filter">
                      <option id="" value="">--------</option>
                      <option value="signed_RF/RP1" {% if query.selected_filter == 'signed_RF/RP1' %} selected {% endif %}>Contratos assinados pelo Responsável Financeiro e Pedagógico</option>
                      <option value="not_signed_RF/RP1" {% if query.selected_filter == 'not_signed_RF/RP1' %} selected {% endif %}>Contratos não assinados pelo Responsável Financeiro e Pedagógico</option>
                      <option value="signed_DIR" {% if query.selected_filter == 'signed_DIR' %} selected {% endif %}>Contratos assinados pelo Diretor</option>
                      <option value="not_signed_DIR" {% if query.selected_filter == 'not_signed_DIR' %} selected {% endif %}>Contratos não assinados pelo Diretor</option>
                      <option value="purchased_slm" {% if query.selected_filter == 'purchased_slm' %} selected {% endif %}>Contratos com material já comprado</option>
                      <option value="not_purchased_slm" {% if query.selected_filter == 'not_purchased_slm' %} selected {% endif %}>Contratos com material não comprado</option>
                    </select>
                  </div>
                </div>
                <input type="hidden" id="selected_filter" name="selected_filter">
                <input type="hidden" id="selected_school" name="selected_school" value="0">
                <input type="hidden" id="selected_class" name="selected_class" value="0">
                <input type="text" id="search" name="search"
                  placeholder="Insira o nome do aluno, o nome da escola ou o nome da turma">
                <input type="hidden" id="selected_chain" name="selected_chain">
                <div style="margin-top: 10px">
                  <button class="btn btn-info btn-fill pull-left" type="submit"
                    style="background-color: #3CB371; border-color: #3CB371">Buscar</button>
                  <input type="button" onClick="limpa()" class="btn btn-info btn-fill pull-left"
                    style="background-color: #B22222; border-color: #B22222; margin-left: 30px;"
                    value="Limpar" />
                  <input type="button" onClick="exportTableToCSV('Contratos.csv')" class="btn btn-info btn-fill pull-left"
                    style="background-color: #1D23D7; border-color: #1D23D7; margin-left: 30px;"
                    value="Exportar" />
                </div>
                <div class="clearfix"></div>
            </form>
          </div>
        </div>
      </div>
      <div>
      </div>


    </div>
  </div>
</div>
{% if contracts %}
<div class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card strpied-tabled-with-hover">
          <div class="card-header ">
            <h4 class="card-title">Resultados</h4>
          </div>
          <form>
            <div class="card-body table-full-width table-responsive">
              {% if is_supervisor or is_witness %}
              <div class="col-md-12">
                <button id="sign-multiple-id1"
                  class="multi-select-button btn btn-dark btn-sm btn-block sign-multiples-buttons" data-toggle="modal"
                  data-target="#multi-sign-contract-modal">
                  Clique Aqui Para Assinar Contratos Selecionados
                </button>
              </div>
              {% endif %}
              <table class="table table-hover table-striped display row-border mb-4" id="contractstable">
                <thead>
                  <tr>
                    {% if is_supervisor or is_witness %}
                    <th>
                      <input id="selectall" type="checkbox" name="selectall" onclick="select_all(this)">
                    </th>
                    {% endif %}
                    <th>Id do Contrato</th>
                    <th>Escola</th>
                    <th>Turma</th>
                    <th>Nome do Estudante</th>
                    <th>Assinante da Escola</th>
                    <th>Data de Criação do Contrato</th>
                    <!-- <th>Data Final do Contrato</th>
                    <th>Data de Expiração</th> -->
                    <th>Processo do Contrato</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody class="">
                  {% for contract in contracts %}
                  <tr class="pb-5">
                    {% if is_supervisor %}
                      <td>
                        {% if contract.counter_signed %}
                          <label><input type="checkbox" name="checks" value="{{ contract.contract_id }}" checked></label>
                        {% else %}
                          <input type="checkbox" name="checks" value="{{ contract.contract_id }}">
                        {% endif %}
                      </td>
                    {% elif is_witness %}
                      <td>
                        {% if request.user == contract.first_witness_signe.profile %}
                          {% if contract.first_witness_signed %}
                            <label><input type="checkbox" name="checks" value="{{ contract.contract_id }}" checked></label>
                          {% else %}
                            <input type="checkbox" name="checks" value="{{ contract.contract_id }}">
                          {% endif %}
                        {% elif request.user == contract.second_witness_signe.profile %}
                          {% if contract.second_witness_signed %}
                            <label><input type="checkbox" name="checks" value="{{ contract.contract_id }}" checked></label>
                          {% else %}
                            <input type="checkbox" name="checks" value="{{ contract.contract_id }}">
                          {% endif %}
                        {% endif %}
                      </td>
                    {% endif %}

                    <th>
                      {{contract.contract_id}}
                    </th>

                    {% if contract.chain.name %}

                    {% for school in schools %}

                    {% if contract.chain in school.chains.all %}
                    <td>
                      {{ school.school_name }}
                    </td>
                    {% endif %}
                    {% endfor %}

                    <td>
                      {{ contract.chain.classe.class_name }}
                    </td>

                    {% else %}
                    <td></td>
                    <td></td>
                    {% endif %}

                    {% if contract.student_name %}
                    <td>
                      {{ contract.student_name }}
                    </td>
                    {% else %}
                    <td></td>
                    {% endif %}
                    {% if contract.counter_signe.name %}
                    <td>
                      {{ contract.counter_signe.name }}
                    </td>
                    {% else %}
                    <td></td>
                    {% endif %}
                    <td id="{{ contract.contract_id }}_initial_date">
                      {% if contract.date.day < 10 %}0{{ contract.date.day }}{% else %}{{ contract.date.day }}{% endif %}/{% if contract.date.month < 10 %}0{{ contract.date.month }}{% else %}{{ contract.date.month }}{% endif %}/{{ contract.date.year }}
                    </td>
                    <!-- <td>
                      {% if contract.end.day < 10 %}0{{ contract.end.day }}{% else %}{{ contract.end.day }}{% endif %}/{% if contract.end.month < 10 %}0{{ contract.end.month }}{% else %}{{ contract.end.month }}{% endif %}/{{ contract.end.year }}
                    </td>
                    <td>
                      {% if contract.expiration.day < 10 %}0{{ contract.expiration.day }}{% else %}{{ contract.expiration.day }}{% endif %}/{% if contract.expiration.month < 10 %}0{{ contract.expiration.month }}{% else %}{{ contract.expiration.month }}{% endif %}/{{ contract.expiration.year }}
                    </td> -->

                    <td>
                      <!--sign-->
                      {% if contract.slm %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.purchased_slm %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">MATERIAL SLM COMPRADO</label>
                        </div>
                      </div>
                      {% endif %}

                      {% if contract.student_auth_signe %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.student_auth_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_student_auth_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_student_auth_signed"
                              class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">RESPONSÁVEL ESTUDANTE ASSINADO</label>
                        </div>
                      </div>
                      {% endif %}

                      {% if contract.first_auth_signe %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.first_auth_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_first_auth_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_first_auth_signed"
                              class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">RESPONSÁVEL FINANCEIRO ASSINADO</label>
                        </div>
                      </div>
                      {% endif %}

                      {% if contract.second_auth_signe %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.second_auth_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_second_auth_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_second_auth_signed"
                              class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">RESPONSÁVEL PEDAGÓGICO ASSINADO</label>
                        </div>
                      </div>
                      {% endif %}
                      {% if contract.third_auth_signe %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.third_auth_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_third_auth_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_third_auth_signed"
                              class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">TERCEIRO RESPONSÁVEL ASSINADO ASSINADO</label>
                        </div>
                      </div>
                      {% endif %}

                      {% if contract.first_witness_signe and contract.second_witness_signe %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.all_witness_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_all_witness_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_all_witness_signed"
                              class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">TODAS AS TESTEMUNHAS ASSINARAM</label>
                        </div>
                      </div>
                      {% endif %}
                      {% if contract.chain.name %}
                      {% for school in schools %}
                      {% if contract.chain in school.chains.all %}
                      {% if school.is_maple_bear %}
                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.is_paid %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-danger text-danger float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">CONTRATO PAGO</label>
                        </div>
                      </div>
                      {% endif %}
                      {% endif %}
                      {% endfor %}
                      {% endif %}

                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.counter_signed %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_counter_signed"
                              class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span id="{{ contract.contract_id }}_counter_signed"
                              class="badge badge-pill badge-danger text-danger  float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">DIRETOR RESPONSÁVEL ASSINADO</label>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.is_expired %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-danger text-danger  float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">CONTRATO EXPIRADO</label>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-2">
                          {% if contract.is_active %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-success text-success float-right">.</span>
                          </div>
                          {% else %}
                          <div class="margin-5">
                            <span class="badge badge-pill badge-danger text-danger  float-right">.</span>
                          </div>
                          {% endif %}
                        </div>

                        <div class="col-md-10">
                          <label class="label-to-the-middle">CONTRATO ATIVO</label>
                        </div>
                      </div>

                    </td>

                    <td class="w-100">
                      <div class="container" style="white-space: nowrap; text-align: center; width: 92%">

                        {% if request.user.is_superuser %}

                        <div class="row">
                          <div class="col-md-12">
                            {% if contract.first_auth_signed or contract.second_auth_signed or contract.counter_signed %}
                            <a class="btn btn-secondary w-100"
                              href="{% url 'contracts:seecontractdetails' contract.contract_id %}"
                              data-baloon="Remove this item from the cart">
                              Ver Detalhes
                            </a>
                            {% else %}
                            <div class="dropdown show w-100">
                              <a class="btn btn-secondary dropdown-toggle w-100" href="#" role="button"
                                id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Ações
                              </a>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                <a class="dropdown-item"
                                  href="{% url 'contracts:select_student_to_contract_update' contract.contract_id %}"
                                  data-baloon="Remove this item from the cart">Atualizar Contrato</a>
                                <a class="dropdown-item"
                                  href="{% url 'contracts:seecontractdetails' contract.contract_id %}"
                                  data-baloon="Remove this item from the cart">Ver Detalhes</a>
                              </div>
                            </div>
                            {% endif %}
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-9">
                            <a class="btn btn-primary btn-block w-100"
                              href="{% url 'contracts:extend_expire_date' contract.contract_id %}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              Estender Por 7 Dias
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a class="btn btn-primary btn-block w-100"
                            href="{% url 'contracts:edit_dates' contract.contract_id %}" target="popup" onclick="window.open('{% url 'contracts:edit_dates' contract.contract_id %}','popup','width=800,height=600'); return false;"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              <i class="fas fa-pencil-alt"></i>
                            </a>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-12">
                            <a class="btn btn-danger btn-block"
                              onclick="changeYesLink('{% url 'contracts:delete_contract' contract.contract_id %}')"
                              href="#" data-baloon="Remove this item from the cart" class="text-light"
                              data-toggle="modal" data-target="#delete-contract-modal">
                              Deletar Contrato
                            </a>
                          </div>
                        </div>

                        {% else %}
                        <div class="row">
                          {% if is_supervisor %}
                          {% if request.user == contract.counter_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.counter_signed %}
                            <!--Verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_counter_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% endif %}
                          {% elif request.user == contract.first_auth_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.first_auth_signed %}
                            <!--verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_first_auth_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% elif request.user == contract.second_auth_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.second_auth_signed %}
                            <!--verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_second_auth_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% elif request.user == contract.third_auth_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.third_auth_signed %}
                            <!--verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_third_auth_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% elif request.user == contract.student_auth_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.student_auth_signed %}
                            <!--verde-->
                            <button id="{{ contract.contract_id }}_student_auth_signed_button" type="button"
                              class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% elif request.user == contract.first_witness_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.first_witness_signed %}
                            <!--verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_first_witness_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% elif request.user == contract.second_witness_signe.profile %}
                          <div class="col-md-12">
                            {% if contract.second_witness_signed %}
                            <!--verde-->
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Assinado
                            </button>
                            {% else %}
                            <!--Vermelho-->
                            <a id="{{ contract.contract_id }}_second_witness_signed_button"
                              class="btn btn-primary btn-danger btn-block w-100"
                              onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#"
                              data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal"
                              data-target="#sign-contract-modal">
                              Assinar Contrato
                            </a>
                            {% endif %}
                          </div>
                          {% endif %}
                        </div>

                        <div class="row">
                          <div class="col-md-12">
                            {% if is_supervisor %}
                            {% if contract.first_auth_signed or contract.second_auth_signed or contract.counter_signed %}
                            <a class="btn btn-secondary btn-block w-100"
                              href="{% url 'contracts:seecontractdetails' contract.contract_id %}"
                              data-baloon="Remove this item from the cart">
                              Ver Detalhes
                            </a>
                            {% else %}
                            <div class="dropdown show">
                              <a class="btn btn-secondary dropdown-toggle w-100" href="#" role="button"
                                id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Ações
                              </a>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                <a class="dropdown-item"
                                  onclick="changeYesLink('{% url 'contracts:delete_contract' contract.contract_id %}')"
                                  href="#" data-baloon="Remove this item from the cart" data-toggle="modal"
                                  data-target="#delete-contract-modal">Deletar Contrato</a>
                                <a class="dropdown-item"
                                  href="{% url 'contracts:seecontractdetails' contract.contract_id %}"
                                  data-baloon="Remove this item from the cart">Ver Detalhes</a>
                              </div>
                            </div>
                            {% endif %}
                            {% else %}
                            <a class="btn btn-secondary btn-block w-100"
                              href="{% url 'contracts:seecontractdetails' contract.contract_id %}"
                              data-baloon="Remove this item from the cart">
                              Ver Detalhes
                            </a>
                            {% endif %}
                          </div>
                        </div>
                        {% endif %}
                        {% if is_supervisor %}
                        <div class="row">
                          <div class="col-md-9">
                            <a class="btn btn-primary btn-block w-100"
                              href="{% url 'contracts:extend_expire_date' contract.contract_id %}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              Estender Por 7 Dias
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a class="btn btn-primary btn-block w-100"
                              href="{% url 'contracts:edit_dates' contract.contract_id %}" target="popup" onclick="window.open('{% url 'contracts:edit_dates' contract.contract_id %}','popup','width=800,height=600'); return false;"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              <i class="fas fa-pencil-alt"></i>
                            </a>
                          </div>
                        </div>
                        {% endif %}
                        {% if contract.pdf %}
                        <div class="row">
                          <div class="col-md-9">
                            <a class="btn btn-primary btn-block w-100" href="{{contract.pdf.url}}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              Ver Contrato
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a class="btn btn-primary btn-block w-100" href="{% url 'contracts:upload_contract_file_to_drive' contract.contract_id 'contract' %}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              <i class="fab fa-google-drive"></i>
                            </a>
                          </div>
                        </div>
                        {% endif %}

                        {% if contract.terms_of_contract %}
                        <div class="row">
                          <div class="col-md-9">
                            <a class="btn btn-primary w-100" href="{{contract.terms_of_contract.url}}" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              Termos Ad. do Contrato (1)
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a class="btn btn-primary btn-block w-100" href="{% url 'contracts:upload_contract_file_to_drive' contract.contract_id 'terms_1' %}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              <i class="fab fa-google-drive"></i>
                            </a>
                          </div>
                        </div>
                        {% endif %}

                        {% if contract.terms_of_contract_2 %}
                        <div class="row">
                          <div class="col-md-9">
                            <a class="btn btn-primary w-100" href="{{contract.terms_of_contract_2.url}}" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              Termos Ad. do Contrato (2)
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a class="btn btn-primary btn-block w-100" href="{% url 'contracts:upload_contract_file_to_drive' contract.contract_id 'terms_2' %}"
                              data-baloon="Remove this item from the cart" style="font-size: 13.5px;justify-content:center;align-items:center; display: flex;">
                              <i class="fab fa-google-drive"></i>
                            </a>
                          </div>
                        </div>
                        {% endif %}
                        {% if contract.slm %}
                        {% if not contract.purchased_slm %}
                        {% if is_supervisor %}
                        <div class="row">
                          <div class="col-md-12">
                            <a class="btn btn-primary w-100"
                              href="{% url 'contracts:mark_slm_purchased' contract.contract_id %}">
                              Manual SLM
                            </a>
                          </div>
                        </div>
                        {% else %}
                        <div class="row">
                          <div class="col-md-12">
                            <a class="btn btn-primary w-100"
                              href="{% url 'contracts:redirect_to_slm_link' contract.contract_id %}">
                              Comprar Material
                            </a>
                          </div>
                        </div>
                        {% endif %}
                        {% else %}
                        <div class="row">
                          <div class="col-md-12">
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Material já comprado
                            </button>
                          </div>
                        </div>
                        {% endif %}
                        {% endif %}
                        {% if request.user.is_superuser or is_supervisor %}
                        {% if contract.chain.name %}
                        {% for school in schools %}
                        {% if contract.chain in school.chains.all %}
                        {% if school.is_maple_bear %}
                        {% if not contract.is_paid %}
                        <div class="row">
                          <div class="col-md-12">
                            <a class="btn btn-primary w-100"
                              href="{% url 'contracts:set_contract_paid' contract.contract_id %}">
                              Setar contrato como pago
                            </a>
                          </div>
                        </div>
                        {% else %}
                        <div class="row">
                          <div class="col-md-12">
                            <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                              Contrato pago
                            </button>
                          </div>
                        </div>
                        {% endif %}
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                  {% endfor %}

                </tbody>
              </table>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
{% if search or selected_school or selected_class %}
<h4>Não há nenhum resultado para a pesquisa feita</h4>
{% endif %}
{% endif %}
<script type="text/javascript">
  function limpa() {
    document.getElementById('selected_school').value = "0";
    document.getElementById('selected_class').value = "0";
    document.getElementById('selected_filter').value = "";
    document.getElementById('search').value = "";
    $('#select_form_school')
      .find('option:first-child').prop('selected', true)
      .end().trigger('chosen:updated');
      $('#select_form_class').html(`<option id="" value="0">--------</option>`)
      $('#select_form_class')
        .find('option:first-child').prop('selected', true)
        .end().trigger('chosen:updated');
    $('#select_form_filter')
      .find('option:first-child').prop('selected', true)
      .end().trigger('chosen:updated');
  }
  let chatSocket = new WebSocket(
    'wss://' + window.location.host +
    ':8002/ws/chat/notifications/');

  chatSocket.onmessage = function (e) {
    console.log('message_incoming');
    let data = JSON.parse(e.data);
    let message = data['message'];
    var contract = message;
    var date = document.getElementById(`${contract['contract_id']}_initial_date`)
    date.innerText = `${contract['date']}`
    if (contract['client_responsible_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_client_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_client_responsible_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['counter_signed'] == true) {
      let dot = document.getElementById(`${contract['contract_id']}_counter_signed`)
      if (dot){
        dot.className = 'badge badge-pill badge-success text-success float-right';
      }
      let button = document.getElementById(`${contract['contract_id']}_counter_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['first_responsible_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_first_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_first_responsible_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['second_responsible_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_second_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_second_responsible_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['first_auth_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_first_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_first_auth_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['second_auth_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_second_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_second_auth_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['third_auth_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_third_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_third_auth_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['first_witness_signed'] == true) {
      let button = document.getElementById(`${contract['contract_id']}_first_witness_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['second_witness_signed'] == true) {
      let button = document.getElementById(`${contract['contract_id']}_second_witness_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    if (contract['all_witness_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_all_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
    }
    if (contract['all_signed'] == true) {
      document.getElementById(`${contract['contract_id']}_all_signed`).className = 'badge badge-pill badge-success text-success float-right';
      let button = document.getElementById(`${contract['contract_id']}_all_signed_button`);
      if (button) {
        button.className = 'btn btn-success btn-block w-100';
        button.style = 'cursor: not-allowed;';
        button.innerText = 'Assinado';
        button.removeAttribute('data-togle');
        button.removeAttribute('onclick');
        button.removeAttribute('data-target');
        button.removeAttribute('href');
      }
    }
    $("#sign-contract-modal").modal('hide');
  }
  chatSocket.onclose = function (e) {
    console.error('Chat socket closed unexpectedly');
  };
  function select_all(ele) {
    var allCheckboxes = document.getElementsByName('checks');
    var is_witness = `{{ is_witness|yesno:"true,false" }}`;
    allCheckboxes.forEach(function (checkbox) {
      if (is_witness === 'true'){
        contract = document.getElementById(`${checkbox.value}_all_witness_signed`)
      }
      else{
        contract = document.getElementById(`${checkbox.value}_counter_signed`)
      }
      if (ele.checked){
        if (contract.classList.contains('badge-danger')){
          checkbox.checked = true;
        }
      }
      else{
        if (contract.classList.contains('badge-danger')){
          checkbox.checked = false;
        }
      }
      });
  }
  function signContract(url) {
    setTimeout(function () {
      // window.location.assign(url);
      $.get(url)
        .done(function (response) {
          var contract = response['contract'];
          if (contract['client_responsible_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_client_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_client_responsible_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['counter_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_counter_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_counter_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['first_responsible_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_first_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_first_responsible_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['second_responsible_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_second_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_second_responsible_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['first_auth_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_first_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_first_auth_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['second_auth_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_second_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_second_auth_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['third_auth_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_third_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_third_auth_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['first_witness_signed'] == true) {
            let button = document.getElementById(`${contract['contract_id']}_first_witness_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['second_witness_signed'] == true) {
            let button = document.getElementById(`${contract['contract_id']}_second_witness_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          if (contract['all_witness_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_all_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
          }
          if (contract['all_signed'] == true) {
            document.getElementById(`${contract['contract_id']}_all_signed`).className = 'badge badge-pill badge-success text-success float-right';
            let button = document.getElementById(`${contract['contract_id']}_all_signed_button`);
            if (button) {
              button.className = 'btn btn-success btn-block w-100';
              button.style = 'cursor: not-allowed;';
              button.innerText = 'Assinado';
              button.removeAttribute('data-togle');
              button.removeAttribute('onclick');
              button.removeAttribute('data-target');
              button.removeAttribute('href');
            }
          }
          $("#sign-contract-modal").modal('hide');
        });
    }, 1);
  }
  $(document).on("change", "#initial_date", function () {
    document.getElementById("final_date").min = this.value
  });
  $(document).ready(function () {
    $('#select_form_school').on('change', function () {
      let urlClasses = $('#myForm').data('urlclasses')
      var selectValor = $(this).val();
      $.ajax({
        url: urlClasses,
        data: {
          id: selectValor
        },
        success: function (response) {
          $('#select_form_class').html(response);
          $('#select_form_class').trigger("chosen:updated");
        }
      })
      if (selectValor == '') {
        document.getElementById('selected_school').value = '0'
      }
      else {
        document.getElementById('selected_school').value = selectValor
      }
    });
  });
  $(document).ready(function () {
    $('#select_form_class').on('change', function () {
      var selectValor = $(this).val();
      if (selectValor == '') {
        document.getElementById('selected_class').value = '0'
      }
      else {
        document.getElementById('selected_class').value = selectValor
      }
    });
  });
  $(document).ready(function () {
    $('#select_form_filter').on('change', function () {
      var selectValor = $(this).val();
      if (selectValor == '') {
        document.getElementById('selected_filter').value = ''
      }
      else {
        document.getElementById('selected_filter').value = selectValor
      }
    });
  });
  $(document).ready(function () {

    $('#contractstablebutton').addClass('non-interactable');
    $('#contractstable').DataTable({
      initComplete: function () {
        $('#contractstablebutton').removeClass('non-interactable');
      }
    })
    $(window).on('resize', function () {
      $('#contractstable').DataTable();
    });
  });
</script>

<script type="text/javascript">
  function changeYesLink(url) {
    document.getElementById("link_to_delete").href = url;
  }

  window.addEventListener('load', function () {

    var element1 = document.getElementById("sign-multiple-id1");
    var is_witness = `{{ is_witness|yesno:"true,false" }}`;

    element1.addEventListener('click', trySignMultiples);

    function trySignMultiples(/** @type Event */event) {

      // event.stopImmediatePropagation();

      /** @type NodeList*/
      var allCheckboxes = document.getElementsByName('checks');
      var selectall = document.getElementById('selectall');

      var hasAtLeastOneChecked = false;
      allCheckboxes.forEach(function (checkbox) {
        hasAtLeastOneChecked = hasAtLeastOneChecked || checkbox.checked;
      });
      console.log(hasAtLeastOneChecked)

      if (!hasAtLeastOneChecked && !selectall.checked) {
        event.preventDefault();
        $('#multi-sign-contract-modal').modal();
        $('#multi-sign-contract-modal-message').text('Por favor, selecione um contrato!');
      } else {
        event.preventDefault();
        setTimeout(function () {
          $('#multi-sign-contract-modal').modal("hide");
          setTimeout(function () {
            $('#multi-sign-contract-modal-message').text('Por favor, espere um pouco. Estamos criptografando seus contratos!');
            allCheckboxes.forEach(function (checkbox) {
              var myInit = {
                credentials: 'same-origin',
                cache: 'default'
              };
              if (is_witness === 'true'){
                contract = document.getElementById(`${checkbox.value}_all_witness_signed`)
              }
              else{
                contract = document.getElementById(`${checkbox.value}_counter_signed`)
              }
              if (contract.classList.contains('badge-danger')){
                if (checkbox.checked || selectall.checked) {
                  fetch(`/contracts/queue_set_signed/${checkbox.value}`, myInit)
                  console.log('Entrou')
                }
              }
            });
            window.location.assign('/contracts/all/')
          }, 30);
        }, 2000);
      }
    }
  })
  $(document).ready(function () {
    jQuery(window).on('resize', function () {
      $("#select_form_school_chosen").attr('style', 'width: 100%');
      $("#select_form_class_chosen").attr('style', 'width: 100%');
      $("#select_form_filter_chosen").attr('style', 'width: 100%');
    });
  });

</script>

<!-- Contract Modal -->
<div id="delete-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">x</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Você tem certeza que deseja deletar esse contrato? Essa operação não pode ser desfeita!</p>
      </div>
      <div class="modal-footer">
        <a id="link_to_delete" class="btn btn-danger btn-block" href="">Sim</a>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Não</button>
      </div>
    </div>

  </div>
</div>
<div id="sign-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-body">
        <p>Por favor, espere um pouco. Estamos criptografando seu contrato!</p>
      </div>
    </div>

  </div>
</div>

<!-- Multiples Contracts Modal -->
<div id="multi-sign-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-body">
        <p id="multi-sign-contract-modal-message">Por favor, espere um pouco. Estamos criptografando seus contratos!</p>
      </div>
    </div>

  </div>
</div>

{% endblock %}