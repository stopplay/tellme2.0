{% extends 'base.html'%}

{% block title %} Contrato(s) {% endblock %}

{% block content %}

<div class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        {% if contracts %}
          <div class="card strpied-tabled-with-hover">
            
            <div class="card-header ">
              {% if request.user.is_superuser %}
                <h4 class="card-title">Contrato(s)</h4>
              {% else %}
                <h4 class="card-title">Contrato(s) do {{ request.user.username }}</h4>
              {% endif %}
            </div>

            <form method="POST" enctype="multipart/form-data" > {% csrf_token %}
              {% if is_supervisor or is_witness %}
                <div class="col-md-12">
                  <button id="sign-multiple-id1" type="submit" class="multi-select-button btn btn-dark btn-sm btn-block sign-multiples-buttons" data-toggle="modal" data-target="#multi-sign-contract-modal">
                    Clique Aqui Para Assinar Contratos Selecionados
                  </button>
                </div>
              {% endif %}

              <div class="card-body table-full-width table-responsive">

                <table class="table table-hover table-striped display row-border mb-4" id="contractstable">
                  <thead>
                    <tr>
                      {% if is_supervisor or is_witness %}
                        <th>
                          <input id="check" type="checkbox" name="select_all">
                        </th>
                      {% endif %}
                      <th>Id do Contrato</th>
                      <th>Escola</th>
                      <th>Turma</th>
                      <th>Nome do Estudante</th>
                      <th>Assinante da Escola</th>
                      <th>Data Inicial do Contrato</th>
                      <th>Data Final do Contrato</th>
                      <th>Data de Expiração de Assinatura do Contrato</th>
                      <th>Processo do Contrato</th>
                      <th >Ações</th>
                    </tr>
                  </thead>
                  <tbody class="">
                    {% for contract in contracts %}
                      <tr class="pb-5">
                        {% if is_supervisor %}
                          <td>
                            {% if contract.counter_signed %}
                            <label><input type="checkbox" name="checks" value="{{ contract.contract_id }}" checked></label>
                            {% else %}
                            <input type="checkbox" name="checks" value="{{ contract.contract_id }}">
                            {% endif %}
                          </td>
                        {% endif %}

                        <th>
                          {{contract.contract_id}}
                        </th>
                        
                        {% if contract.chain.name %}
                          
                          {% for school in schools %}
                          
                            {% if contract.chain in school.chains.all %}
                              <td>
                                {{ school.school_name }}
                              </td>
                            {% endif %}

                            {% for classe in school.classes.all %}
                              {% if classe.class_name in contract.chain.name %}
                                {% if classe.class_unit in contract.chain.name %}
                                  {% for student in contract.first_auth_signe.first_parent.all %}
                                    {% if student.name == contract.student_name %}
                                      {% if student in classe.students.all %}
                                        <td>
                                          {{ classe.class_name }}
                                        </td>
                                        {{ "<!--" }}
                                      {% endif %}
                                    {% endif %}
                                  {% endfor %}
                                {% endif %}
                              {% endif %}
                            {% endfor %}

                          {% endfor %}
                        {{ "-->" }}
                        
                        {% else %}
                          <td></td>
                          <td></td>
                        {% endif %}
                        
                        {% if contract.student_name %}
                          <td>
                            {{ contract.student_name }}
                          </td>
                        {% else %}
                          <td></td>
                        {% endif %}
                        {% if contract.counter_signe.name %}
                          <td>
                            {{ contract.counter_signe.name }}
                          </td>
                        {% else %}
                          <td></td>
                        {% endif %}
                        <td>
                          {% if contract.date.day < 10 %}0{{ contract.date.day }}{% else %}{{ contract.date.day }}{% endif %}/{% if contract.date.month < 10 %}0{{ contract.date.month }}{% else %}{{ contract.date.month }}{% endif %}/{{ contract.date.year }}
                        </td>
                        <td>
                          {% if contract.end.day < 10 %}0{{ contract.end.day }}{% else %}{{ contract.end.day }}{% endif %}/{% if contract.end.month < 10 %}0{{ contract.end.month }}{% else %}{{ contract.end.month }}{% endif %}/{{ contract.end.year }}
                        </td>
                        <td>
                          {% if contract.expiration.day < 10 %}0{{ contract.expiration.day }}{% else %}{{ contract.expiration.day }}{% endif %}/{% if contract.expiration.month < 10 %}0{{ contract.expiration.month }}{% else %}{{ contract.expiration.month }}{% endif %}/{{ contract.expiration.year }}
                        </td>

                        <td>
                          <!--sign-->
                          {% if contract.slm %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.purchased_slm %}
                                  <div class="margin-5">
                                    <span class="badge badge-pill badge-success text-success float-right" >.</span>
                                  </div>
                                {% else %}
                                  <div class="margin-5">
                                    <span class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                  </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">MATERIAL SLM COMPRADO</label>
                              </div>
                            </div>
                          {% endif %}

                          {% if contract.student_auth_signe %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.student_auth_signed %}
                                  <div class="margin-5">
                                    <span id="{{ contract.contract_id }}_student_auth_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                  </div>
                                {% else %}
                                  <div class="margin-5">
                                    <span id="{{ contract.contract_id }}_student_auth_signed" class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                  </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">RESPONSÁVEL ESTUDANTE ASSINADO</label>
                              </div>
                            </div>
                          {% endif %}

                          {% if contract.first_auth_signe %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.first_auth_signed %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_first_auth_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                </div>
                                {% else %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_first_auth_signed" class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">RESPONSÁVEL FINANCEIRO ASSINADO</label>
                              </div>
                            </div>
                          {% endif %}

                          {% if contract.second_auth_signe %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.second_auth_signed %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_second_auth_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                </div>
                                {% else %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_second_auth_signed" class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">RESPONSÁVEL PEDAGÓGICO ASSINADO</label>
                              </div>
                            </div>
                          {% endif %}
                          {% if contract.third_auth_signe %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.third_auth_signed %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_third_auth_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                </div>
                                {% else %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_third_auth_signed" class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">TERCEIRO RESPONSÁVEL ASSINADO ASSINADO</label>
                              </div>
                            </div>
                          {% endif %}

                          {% if contract.first_witness_signe and contract.second_witness_signe %}
                            <div class="row">
                              <div class="col-md-2">
                                {% if contract.all_witness_signed %}
                                  <div class="margin-5">
                                    <span id="{{ contract.contract_id }}_all_witness_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                  </div>
                                {% else %}
                                  <div class="margin-5">
                                    <span id="{{ contract.contract_id }}_all_witness_signed" class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                  </div>
                                {% endif %}
                              </div>

                              <div class="col-md-10">
                                <label class="label-to-the-middle">TODAS AS TESTEMUNHAS ASSINARAM</label>
                              </div>
                            </div>
                          {% endif %}

                          {% if contract.chain.name %}
                            {% for school in schools %}
                              {% if contract.chain in school.chains.all %}
                                {% if school.is_maple_bear %}
                                  <div class="row">
                                    <div class="col-md-2">
                                      {% if contract.is_paid %}
                                        <div class="margin-5">
                                          <span class="badge badge-pill badge-success text-success float-right" >.</span>
                                        </div>
                                      {% else %}
                                        <div class="margin-5">
                                          <span class="badge badge-pill badge-danger text-danger float-right" >.</span>
                                        </div>
                                      {% endif %}
                                    </div>

                                    <div class="col-md-10">
                                      <label class="label-to-the-middle">CONTRATO PAGO</label>
                                    </div>
                                  </div>
                                {% endif %}
                              {% endif %}
                            {% endfor %}
                          {% endif %}

                          <div class="row">
                            <div class="col-md-2">
                              {% if contract.counter_signed %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_counter_signed" class="badge badge-pill badge-success text-success float-right" >.</span>
                                </div>
                              {% else %}
                                <div class="margin-5">
                                  <span id="{{ contract.contract_id }}_counter_signed" class="badge badge-pill badge-danger text-danger  float-right" >.</span>
                                </div>
                              {% endif %}
                            </div>

                            <div class="col-md-10">
                              <label class="label-to-the-middle">DIRETOR RESPONSÁVEL ASSINADO</label>
                            </div>
                          </div>

                        </td>

                        <td class="w-100">
                          <div class="container" style="white-space: nowrap; text-align: center; width: 92%">

                            {% if request.user.is_superuser %}
                            
                              <div class="row">
                                <div class="col-md-12">
                                  {% if contract.first_auth_signed or contract.second_auth_signed or contract.counter_signed %}
                                    <a class="btn btn-secondary w-100" href="{% url 'contracts:seecontractdetails' contract.contract_id %}" data-baloon="Remove this item from the cart">
                                      Ver Detalhes
                                    </a>
                                  {% else %}
                                    <div class="dropdown show w-100">
                                      <a class="btn btn-secondary dropdown-toggle w-100" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Ações
                                      </a>
                                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                        <a class="dropdown-item" href="{% url 'contracts:select_student_to_contract_update' contract.contract_id %}" data-baloon="Remove this item from the cart">Atualizar Contrato</a>
                                        <a class="dropdown-item" href="{% url 'contracts:seecontractdetails' contract.contract_id %}" data-baloon="Remove this item from the cart">Ver Detalhes</a>
                                      </div>
                                    </div>
                                  {% endif %}
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  <a class="btn btn-danger btn-block" onclick="changeYesLink('{% url 'contracts:delete_contract' contract.contract_id %}')" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#delete-contract-modal">
                                    Deletar Contrato
                                  </a>
                                </div>
                              </div>

                            {% else %}
                              <div class="row">
                                {% if is_supervisor %}
                                  {% if request.user == contract.counter_signe.profile %}
                                    <div class="col-md-12">
                                      {% if contract.counter_signed %}
                                        <!--Verde-->
                                        <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                          Assinado
                                        </button>
                                      {% else %}
                                        <!--Vermelho-->
                                        <a id="{{ contract.contract_id }}_counter_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                          Assinar Contrato
                                        </a>
                                      {% endif %}
                                    </div>
                                  {% endif %}
                                {% elif request.user == contract.first_auth_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.first_auth_signed %}
                                      <!--verde-->
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a id="{{ contract.contract_id }}_first_auth_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% elif request.user == contract.second_auth_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.second_auth_signed %}
                                      <!--verde-->
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a id="{{ contract.contract_id }}_second_auth_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% elif request.user == contract.third_auth_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.third_auth_signed %}
                                      <!--verde-->
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a id="{{ contract.contract_id }}_third_auth_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% elif request.user == contract.student_auth_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.student_auth_signed %}
                                      <!--verde-->
                                      <button id="{{ contract.contract_id }}_student_auth_signed_button" type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% elif request.user == contract.first_witness_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.first_witness_signed %}
                                      <!--verde-->
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a id="{{ contract.contract_id }}_first_witness_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% elif request.user == contract.second_witness_signe.profile %}
                                  <div class="col-md-12">
                                    {% if contract.second_witness_signed %}
                                      <!--verde-->
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Assinado
                                      </button>
                                    {% else %}
                                      <!--Vermelho-->
                                      <a id="{{ contract.contract_id }}_second_witness_signed_button" class="btn btn-primary btn-danger btn-block w-100" onclick="signContract('{% url 'contracts:set_signed' contract.contract_id %}');" href="#" data-baloon="Remove this item from the cart" class="text-light" data-toggle="modal" data-target="#sign-contract-modal">
                                        Assinar Contrato
                                      </a>
                                    {% endif %}                                  
                                  </div>
                                {% endif %}
                              </div>

                              <div class="row">
                                <div class="col-md-12">
                                  {% if is_supervisor %}
                                    {% if contract.first_auth_signed or contract.second_auth_signed or contract.counter_signed %}
                                      <a class="btn btn-secondary btn-block w-100" href="{% url 'contracts:seecontractdetails' contract.contract_id %}" data-baloon="Remove this item from the cart">
                                        Ver Detalhes
                                      </a>
                                    {% else %}
                                      <div class="dropdown show">
                                        <a class="btn btn-secondary dropdown-toggle w-100" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                          Ações
                                        </a>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                          <a class="dropdown-item" onclick="changeYesLink('{% url 'contracts:delete_contract' contract.contract_id %}')" href="#" data-baloon="Remove this item from the cart" data-toggle="modal" data-target="#delete-contract-modal">Deletar Contrato</a>
                                          <a class="dropdown-item" href="{% url 'contracts:seecontractdetails' contract.contract_id %}" data-baloon="Remove this item from the cart">Ver Detalhes</a>
                    
                                        </div>
                                      </div>
                                    {% endif %}
                                  {% else %}
                                    <a class="btn btn-secondary btn-block w-100" href="{% url 'contracts:seecontractdetails' contract.contract_id %}" data-baloon="Remove this item from the cart">
                                      Ver Detalhes
                                    </a>
                                  {% endif %}
                                </div>
                              </div>
                              {% endif %}
                          
                              {% if contract.pdf %}
                                <div class="row" >                        
                                  <div class="col-md-12">
                                    <a  class="btn btn-primary btn-block w-100" href="{% url 'contracts:serve_protected' contract.pdf.name contract.contract_id 'contract' %}" data-baloon="Remove this item from the cart">
                                      Ver Contrato
                                    </a>
                                  </div>
                                </div>
                              {% endif %}
                              
                              {% if contract.terms_of_contract %}
                                <div class="row">
                                  <div class="col-md-12">
                                    <a class="btn btn-primary w-100" href="{% url 'contracts:serve_protected' contract.terms_of_contract.name contract.contract_id 'terms_1' %}">
                                      Ver Termos Aditivos do Contrato (1)
                                    </a>
                                  </div>
                                </div>
                              {% endif %}

                              {% if contract.terms_of_contract_2 %}
                                <div class="row">                      
                                  <div class="col-md-12">
                                    <a class="btn btn-primary w-100" href="{% url 'contracts:serve_protected' contract.terms_of_contract_2.name contract.contract_id 'terms_2' %}">
                                        Ver Termos Aditivos do Contrato (2)
                                    </a>
                                  </div>
                                </div>
                              {% endif %}
                              {% if contract.slm %}
                                {% if not contract.purchased_slm %}
                                  {% if is_supervisor %}
                                  <div class="row">                      
                                    <div class="col-md-12">
                                      <a class="btn btn-primary w-100" href="{% url 'contracts:mark_slm_purchased' contract.contract_id %}">
                                        Confirmação manual de compra SLM
                                      </a>
                                    </div>
                                  </div>
                                  {% else %}
                                  <div class="row">                      
                                    <div class="col-md-12">
                                      <a class="btn btn-primary w-100" href="{% url 'contracts:redirect_to_slm_link' contract.contract_id %}">
                                        Ir para o site de compras de material
                                      </a>
                                    </div>
                                  </div>
                                  {% endif %}
                                {% else %}
                                  <div class="row">                      
                                    <div class="col-md-12">
                                      <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                        Material já comprado
                                      </button>
                                    </div>
                                  </div>
                                {% endif %}
                              {% endif %}
                              {% if request.user.is_superuser or is_supervisor %}
                                {% if contract.chain.name %}
                                  {% for school in schools %}
                                    {% if contract.chain in school.chains.all %}
                                      {% if school.is_maple_bear %}
                                        {% if not contract.is_paid %}
                                          <div class="row">                      
                                            <div class="col-md-12">
                                              <a class="btn btn-primary w-100" href="{% url 'contracts:set_contract_paid' contract.contract_id %}">
                                                Setar contrato como pago
                                              </a>
                                            </div>
                                          </div>
                                        {% else %}
                                          <div class="row">                      
                                            <div class="col-md-12">
                                              <button type="button" class="btn btn-success btn-block w-100" style="cursor: not-allowed;">
                                                Contrato pago
                                              </button>
                                            </div>
                                          </div>
                                        {% endif %}
                                      {% endif %}
                                    {% endif %}
                                  {% endfor %}
                                {% endif %}
                              {% endif %}
                          </div>
                        </td>
                      </tr>
                    {% endfor %}

                  </tbody>
                </table>
                
                <input type="hidden" name="variable" id="variable" value=false>
              </div>      
            </form>
          </div>
        {% else %}
        <div class="card strpied-tabled-with-hover">
            
            <div class="card-header ">
              <h4 class="card-title">Você ainda não possui contrato registrado no sistema!</h4>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready( function () {
    $('#contractstable').DataTable();
  } );
</script>
<script type="text/javascript">
  $(document).ready(function () {
    $('#check').on('change',function () {
      var table = $('#contractstable');
      /** @type HTMLInputElement */
      var selectAllCheckboxes = document.getElementsByName('select_all')[0];
      document.getElementById('variable').value = selectAllCheckboxes.checked;
      var allCheckboxes = document.getElementsByName('checks');
      
      allCheckboxes.forEach(function(/** @type HTMLInputElement */ checkbox) {
        checkbox.checked = selectAllCheckboxes.checked;
      });
    });
  });
</script>


<script type="text/javascript">

let chatSocket = new WebSocket(
          'wss://' + window.location.host +
          ':8002/ws/chat/notifications/');

      chatSocket.onmessage = function(e) {
          console.log('message_incoming');
          let data = JSON.parse(e.data);
          let message = data['message'];
          var contract = message;
          if (contract['client_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_client_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_client_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['counter_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_counter_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_counter_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['third_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_third_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_third_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_witness_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_witness_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_witness_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_witness_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['all_signiture_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_all_signe_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_all_signe_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['all_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_all_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_all_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            $("#sign-contract-modal").modal('hide');
        }
      chatSocket.onclose = function(e) {
          console.error('Chat socket closed unexpectedly');
      };
  function changeYesLink(url){
    document.getElementById("link_to_delete").href=url;
  }
  function signContract(url) {
    setTimeout(function () {
        // window.location.assign(url);
        $.get(url)
          .done(function (response) {
            var contract = response['contract'];
            if (contract['client_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_client_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_client_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['counter_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_counter_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_counter_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_responsible_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_responsible_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_responsible_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['third_auth_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_third_auth_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_third_auth_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['first_witness_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_first_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_first_witness_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['second_witness_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_second_witness_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_second_witness_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['all_signiture_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_all_signe_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_all_signe_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            if (contract['all_signed'] == true) {
              document.getElementById(`${contract['contract_id']}_all_signed`).className = 'badge badge-pill badge-success text-success float-right';
              let button = document.getElementById(`${contract['contract_id']}_all_signed_button`);
              if (button) {
                button.className = 'btn btn-success btn-block w-100';
                button.style = 'cursor: not-allowed;';
                button.innerText = 'Assinado';
                button.removeAttribute('data-togle');
                button.removeAttribute('onclick');
                button.removeAttribute('data-target');
                button.removeAttribute('href');
              }
            }
            $("#sign-contract-modal").modal('hide');
          });
      }, 1);
    }

  window.addEventListener('load', function() {

    var element1 = document.getElementById("sign-multiple-id1");
    var element2 = document.getElementById("sign-multiple-id2");

    element1.addEventListener('click', trySignMultiples);
    element2.addEventListener('click', trySignMultiples);

    function trySignMultiples(/** @type Event */event) {
      
      // event.stopImmediatePropagation();
      
      /** @type NodeList*/
      var allCheckboxes = document.getElementsByName('checks');
      
      var hasAtLeastOneChecked = false;
      allCheckboxes.forEach(function(checkbox) {
        hasAtLeastOneChecked = hasAtLeastOneChecked || checkbox.checked;
      });
      
      if (!hasAtLeastOneChecked) {
        event.preventDefault();
        $('#multi-sign-contract-modal').modal();
        $('#multi-sign-contract-modal-message').text('Por favor, selecione um contrato!');

        setTimeout(function() {
          $('#multi-sign-contract-modal').modal("hide");
          setTimeout(function() {
            $('#multi-sign-contract-modal-message').text('Por favor, espere um pouco. Estamos criptografando seus contratos!');
          }, 100);
        }, 2000);
      }
    }
  })

</script>

<!-- Contract Modal -->
<div id="delete-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dimiss="modal" aria-label="Close">
          <span aria-hidden="true">x</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Você tem certeza que deseja deletar esse contrato? Essa operação não pode ser desfeita!</p>
      </div>
      <div class="modal-footer">
        <a id="link_to_delete" class="btn btn-danger btn-block" href="">Sim</a>
        <button type="button" class="btn btn-secondary w-100" data-dimiss="modal">Não</button>
      </div>
    </div>

  </div>
</div>

<div id="sign-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-body">
        <p>Por favor, espere um pouco. Estamos criptografando seu contrato!</p>
      </div>
    </div>

  </div>
</div>

<!-- Multiples Contracts Modal -->
<div id="multi-sign-contract-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    
    <div class="modal-content">
      <div class="modal-body">
        <p id="multi-sign-contract-modal-message">Por favor, espere um pouco. Estamos criptografando seus contratos!</p>
      </div>
    </div>
    
  </div>
</div>

{% endblock %}
