{% extends 'base.html'%}

{% block title %} Selecionar estudante para contrato {% endblock %}

{% block content %}

{% load static %}
<script>
	$(document).ready(function () {
		$('.container').removeClass('container');
	});
</script>

<div class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-9">
				<div class="card w-50">
					<div class="card-header">
						<h4 class="card-title" align="left">Selecionar estudante para contrato</h4>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-md-11 pr-1">
								<div class="form-group">
									<form id="myForm" method="POST" class="" enctype="multipart/form-data"
										data-urlclasses="{% url 'users:classes_choices_ajax' %}"
										data-urlstudents="{% url 'users:students_choices_ajax' %}"> {% csrf_token %}
										<div style="margin-top: 10px">
											<p><label>Você deseja criar em lote?</label><br><label
													style="margin-right: 10px">Não</label><label class="switch">
													<input type="checkbox" id="first_checkbox">
													<a id="first_slider" class="slider round"></a>
												</label><label style="margin-left: 10px">Sim</label></p>
										</div>
										<div id="to_hide_schools" style="display: none;">
											<div class="labelandform">
												<p><label>Selecione a escola que você deseja criar contrato:</label></p>
												<select class="custom-select chosen-select" id="select_form_school">
													<option id="" value="0" selected>--------</option>
													{% for school in schools %}
													<option value="{{ school.school_id }}">{{ school.school_name }}
													</option>
													{% endfor %}
												</select>
											</div>
											<div class="labelandform">
												<p><label>Selecione a Turma:</label></p>
												<select class="custom-select" id="select_form_class">
													<option id="" value="0" selected>--------</option>
												</select>
											</div>
											<input type="hidden" id="selected_school" name="selected_school">
											<input type="hidden" id="selected_class" name="selected_class">
										</div>
										<div id="to_hide_students">
											<p>Selecione o(s) Estudante(s)</p>
											<select id="select_form" class="form-control chosen-select">
												<option id="" value="0" selected>--------</option>
												{% for student in students %}
												<option value="{{ student.student_id }}">{{ student.school_name }} - {{ student.name }}</option>
												{% endfor %}
											</select><br>
										</div>
										<input type="hidden" id="selected_user" name="selected_user">


										<div><button type="submit" class="btn btn-info btn-fill btn-sm pull-left mt-2"
												style="background-color: #213f99; border-color: #213f99">Próximo</button>
										</div>

									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).on("click", "#first_slider", function () {
		if (!$('#first_checkbox').prop("checked")) {
			$('#first_checkbox').attr('checked')
			$('#to_hide_schools').show();
			$('#to_hide_students').hide();
			selected_user = document.getElementById('selected_user')
			if (selected_user.value) {
				document.getElementById('selected_user').removeAttribute('value');
			}
		}
		else {
			$('#first_checkbox').removeAttr('checked')
			$('#to_hide_schools').hide();
			$('#to_hide_students').show();
			selected_school = document.getElementById('selected_school');
			if (selected_school.value) {
				document.getElementById('selected_school').removeAttribute('value');
			}
			selected_class = document.getElementById('selected_class')
			if (selected_class.value) {
				document.getElementById('selected_class').removeAttribute('value');
			}
		}
		$('#select_form_chosen').attr('style', 'width: 100%;');
		$('#select_form_school_chosen').attr('style', 'width: 100%;');
	});
	$(document).ready(function () {
		$('#select_form_school').on('change', function () {
			let urlClasses = $('#myForm').data('urlclasses')
			var selectValor = $(this).val();
			$.ajax({
				url: urlClasses,
				data: {
					id: selectValor
				},
				success: function (response) {
					$('#select_form_class').html(response)
				}
			})
			if (selectValor == '') {
				document.getElementById('selected_school').value = '0'
			}
			else {
				document.getElementById('selected_school').value = selectValor
			}
			document.getElementById('selected_user').removeAttribute('value')
		});
	});

	$(document).ready(function () {
		$('#select_form_class').on('change', function () {
			var selectValor = $(this).val();
			if (selectValor == '') {
				document.getElementById('selected_class').value = '0'
			}
			else {
				document.getElementById('selected_class').value = selectValor
			}
			document.getElementById('selected_user').removeAttribute('value')
		});
	});

	$(document).ready(function () {
		$('#select_form').on('change', function () {
			var selectValor = $(this).val();
			if (selectValor == '') {
				document.getElementById('selected_user').value = '0'
			}
			else {
				document.getElementById('selected_user').value = selectValor
			}
		});
	});
	$(document).ready(function () {
		$('#first_input').on('change', function () {
			var selectValor = $(this).val($(this).is(':checked'));
			if (selectValor == '') {
				$('#pai').children('div').remove();
				$('#child').children('div').remove();
			}
			else if (selectValor == true) {

			}
			else if (selectValor == false) {
				$('#pai').children('div').remove();
				$('#child').children('div').remove();
				document.getElementById('wish').value = 'não'
				document.getElementById('wish_today').value = 'não'
			}
		});
	});
	function select() {
		if (!$('#second_checkbox').prop("checked")) {
			$('#child').append('<div id="não"><p><div class="form-group"><label>Que dia você deseja que seja enviado o seu contrato?</label><label>Data do Agendamento: </label><input class="labelandform" type="date" name="date" style="width:120%"></div></p></div>')
			document.getElementById('wish_today').value = 'não'

		}
		else {
			$('#second_checkbox').removeAttr('checked')
			$('#child').children('#não').remove();
			document.getElementById('wish_today').value = 'sim'
			$('#second_checkbox').attr('checked')
		}
	}
</script>

{% endblock %}