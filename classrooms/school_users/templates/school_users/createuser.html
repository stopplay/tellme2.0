{% extends 'base.html'%}

{% block title %} Criar um Novo Usuário {% endblock %}

{% block content %}
<script>
	$(document).ready(function () {
		$('.container').removeClass('container');
	});
</script>


<div class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-9">
				<div class="card w-50">
					<div class="card-header">
						<h4 class="card-title">Criar um Novo Usuário</h4>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-md-11 pr-1">
								<div class="form-group">
									<form method="POST" class="" enctype="multipart/form-data" id="myForm"
									data-urlclasses="{% url 'users:classes_choices_ajax' %}" data-urlpassword="{% url 'users:generate_password' %}"> {% csrf_token %}

									<div class="clearfix"></div>
									<div class="labelandform">
										<select class="custom-select" id="select_form">
											<option id="" value="" selected>Selecione o Tipo de Usuário</option>
											{% if request.user.is_superuser %}
											<option value="head_school">Diretor</option>
											{% endif %}
											<!-- <option value="teacher">Professor</option> -->
											{% if request.user.is_superuser %}
											<option value="admin">Admin</option>
											<option value="supervisor">Supervisor</option>
											{% endif %}
											<option value="parent">Responsáveis</option>
											<option value="student">Estudante</option>
											<option value="parentsandstudents">Responsáveis e Estudantes</option>
										</select>
									</div>
									<input type="hidden" id="selected_user" name="selected_user" value="0">
									<div class="clearfix"></div>
									<div class="clearfix"></div>
									<div class="labelandform">
										<select class="custom-select" id="select_form_school">
											<option id="" value="" selected>Selecione a Escola</option>
											{% for school in schools %}
											<option value="{{ school.school_id }}">{{ school.school_name }}</option>
											{% endfor %}
										</select>
									</div>
									<input type="hidden" id="selected_school" name="selected_school" value="0">
									<div class="clearfix"></div>
									<div class="clearfix"></div>
									<div class="labelandform">
										<select class="custom-select" id="select_form_class">
											<option id="" value="" selected>Selecione a Turma</option>
										</select>
									</div>
									<input type="hidden" id="selected_class" name="selected_class" value="0">
									<div class="clearfix"></div>

									<div style="margin-top: 10px" id="first_selection"><label>Você deseja adicionar através de
									CSV?</label><br><label style="margin-right: 10px;">Não</label><label
									class="switch">
									<input type="checkbox" id="first_checkbox">
									<a id="first_slider" class="slider round"></a>
								</label><label style="margin-left: 10px">Sim</label></div>
								<div class="clearfix"></div>
								<div id="pai">
									<div id="não">
										<p>
											<div class="form-group"><label>Nome: </label>
												<div class="">{{ user_form.first_name }}</div>
											</div>
											<div class="form-group"><label>Sobrenome: </label>
												<div class="">{{ user_form.last_name }}</div>
											</div>
											<div class="form-group"><label>Email: </label>
												<div class="">{{ user_form.email }}</div>
											</div>
											<div class="form-group"><label>Senha: </label>
												<div class="">{{ user_form.password1 }}</div>
											</div>
											<div class="form-group"><label>Confirmação de Senha: </label>
												<div class="">{{ user_form.password2 }}</div>
											</div>
											<div></div>
											<div><button class="btn btn-info btn-fill pull-left" type="submit"
												style="background-color: #213f99; border-color: #213f99">Criar
											Usuário</button>
															<!-- <button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">
															Gerar Senha</button> --></div>
														</p>
													</div>
												</div>
												<div id="child">
												</div>
												<input type="hidden" id="sim/não" name="sim/não" value="não">
												<div class="clearfix"></div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<script type="text/javascript">
			$(document).ready(function () {
				$('#select_form_school').on('change', function () {
					let urlClasses = $('#myForm').data('urlclasses')
					var selectValor = $(this).val();
					$.ajax({
						url: urlClasses,
						data: {
							id: selectValor
						},
						success: function (response) {
							$('#select_form_class').html(response)
						}
					})
					if (selectValor == '') {
						document.getElementById('selected_school').value = '0'
					}
					else {
						document.getElementById('selected_school').value = selectValor
					}
				});
			});
			function generate_password(){
				let urlPassword = $('#myForm').data('urlpassword')
				$.ajax({
					url: urlPassword,
					success: function (response) {
						$('#id_password1').value = response
						$('#id_password2').value = response
					}
				})
			}
			$(document).ready(function () {
				$('#select_form_class').on('change', function () {
					var selectValor = $(this).val();
					if (selectValor == '') {
						document.getElementById('selected_class').value = '0'
					}
					else {
						document.getElementById('selected_class').value = selectValor
					}
				});
			});
			$(document).ready(function () {
				$('#select_form').on('change', function () {
					var selectValor = $(this).val();
					if (selectValor == '') {
						document.getElementById('selected_user').value = '0'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'head_school') {
						document.getElementById('selected_user').value = '1'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div>{{ director_form.as_p }}</div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'teacher') {
						document.getElementById('selected_user').value = '2'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div>{{ teacher_form.as_p }}</div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'admin') {
						document.getElementById('selected_user').value = '3'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'supervisor') {
						document.getElementById('selected_user').value = '4'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'parent') {
						document.getElementById('selected_user').value = '5'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_username.label }}</label><div class="">{{ parent_form.maple_bear_username }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_password.label }}</label><div class="">{{ parent_form.maple_bear_password }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_email.label }}</label><div class="">{{ parent_form.maple_bear_email }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'student') {
						document.getElementById('selected_user').value = '6'
						$('#pai').children('div').remove();
						$('#first_selection').show()
						$('#child').children('div').remove();
						$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div>{{ student_form.as_p }}<div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
						document.getElementById('sim/não').value = 'não'
					}
					else if (selectValor == 'parentsandstudents') {
						document.getElementById('selected_user').value = '7'
						$('#first_selection').hide()
						$('#pai').children('#não').remove();
						$('#pai').append('<div id="sim"><p><div class="form-group"><input type="file" name="file"><br><a href="https://drive.google.com/uc?export=download&id=1Il0GTYo-vutzilAKSVsjAbhzazZHnlNZ">Baixe o exemplo</a></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Salvar Usuários</button></div></p></div>');
						document.getElementById('sim/não').value = 'sim'
					}
				});
});
	// $('#select_form_school').change(function(){
	// 	let urlClasses = $('#myForm').data('urlclasses')
	// 	var selectValor = $(this).val();
	// 	$.ajax({
	// 		url:urlClasses,
	// 		data: {
	// 			id: selectValor
	// 		},
	// 		success: function(response) {
	// 			$('#select_form_class').html(response)
	// 		}
	// 	})
	// 	if (selectValor == '') {
	// 		document.getElementById('selected_school').value = '0'
	// 	}
	// 	else{
	// 		document.getElementById('selected_school').value = selectValor
	// 	}
	// })
	$(document).ready(function () {
		$('#first_slider').on('click', function () {
			if (!$('#first_checkbox').prop("checked")) {
				$('#pai').children('#não').remove();
				// $('#pai').append('<div id="sim"><select class="custom-select chosen-select" onchange="select(this)" style="width:115%"><option id="" value="" selected>Você deseja selecionar um arquivo da web?</option><option id="sim" value="sim">Sim</option><option id="não" value="não">Não</option></select> <input type="hidden" id="archive_type" name="archive_type">');
				$('#pai').append('<div id="sim"><p><div class="form-group"><input type="file" name="file"><br><a href="https://drive.google.com/uc?export=download&id=1Il0GTYo-vutzilAKSVsjAbhzazZHnlNZ">Baixe o exemplo</a></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Salvar Usuários</button></div></p></div>');
				document.getElementById('sim/não').value = 'sim'
				$('#first_checkbox').attr('checked')
			}
			else {
				$('#pai').children('#sim').remove();
				$('#child').children('div').remove();
				var selected_user = $('#selected_user').val()
				if (selected_user == '6') {
					$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div>{{ student_form.as_p }}<div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
				}
				else if (selected_user == '5'){
					$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_username.label }}</label><div class="">{{ parent_form.maple_bear_username }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_password.label }}</label><div class="">{{ parent_form.maple_bear_password }}</div></div><div class="form-group"><label>{{ parent_form.maple_bear_email.label }}</label><div class="">{{ parent_form.maple_bear_email }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit" style="background-color: #213f99; border-color: #213f99">Criar Usuário</button><!--<button class="btn btn-info btn-fill pull-right" id="generate_password" style="background-color: #213f99; border-color: #213f99" onclick="generate_password()">Gerar Senha</button>--></div></p>')
				}
				document.getElementById('sim/não').value = 'não'
				$('#first_checkbox').removeAttr('checked')
			}
		});
	});
	// function select(ele){
	// 	var selectValor = $(ele).val();
	// 	if (selectValor == '') {
	// 		$('#child').children('div').remove();
	// 	}
	// 	else if (selectValor == 'sim'){
	// 		$('#child').children('#não').remove();
	// 		$('#child').append('<div id="sim"><p><div class="form-group"><p><div class="form-group"><input type="url" name="url" placeholder="Insira uma url que direcione a um arquivo CSV, ou seja que o final da URL seja .csv" size="100"></div><div><button class="btn btn-info btn-fill pull-left" type="submit">Salvar Usuários</button></div></p></div>')
	// 		document.getElementById('archive_type').value = 'url'
	// 	}
	// 	else if (selectValor == 'não'){
	// 		$('#child').children('#sim').remove();
	// 		$('#child').append('<div id="sim"><p><div class="form-group"><input type="file" name="file"></div><div><button class="btn btn-info btn-fill pull-left" type="submit">Salvar Usuários</button></div></p></div>')
	// 		document.getElementById('archive_type').value = 'file'
	// 	}
	// }
	// $(document).ready(function(){
	// 	$('#pai').children('div').hide();
	// 	$('#pai').children('div').remove();
	// 	$('#select_type_of_add').on('change',function(){
	// 		var selectValor = $(this).val();
	// 		if (selectValor == '') {
	// 			$('#pai').children('div').remove();
	// 			document.getElementById('selected_user').value = '0'
	// 		}
	// 		else if(selectValor == 'sim'){
	// 			$('#pai').children('#não').remove();
	// 			// $('#pai').append('<div id="sim"><select class="custom-select chosen-select" onchange="select(this)" style="width:115%"><option id="" value="" selected>Você deseja selecionar um arquivo da web?</option><option id="sim" value="sim">Sim</option><option id="não" value="não">Não</option></select> <input type="hidden" id="archive_type" name="archive_type">');
	// 			$('#pai').append('<div id="sim"><p><div class="form-group"><input type="file" name="file"><a href="https://drive.google.com/uc?export=download&id=15yZWfIR-N3eM2pvGXABml5UZIwMQPhXe">Baixe o exemplo</a></div><div><button class="btn btn-info btn-fill pull-left" type="submit">Salvar Usuários</button></div></p></div>');
	// 			document.getElementById('sim/não').value = 'sim'
	// 		}
	// 		else if(selectValor == 'não'){
	// 			$('#pai').children('#sim').remove();
	// 			$('#child').children('div').remove();
	// 			$('#pai').append('<div id="não"><p><div class="form-group"><label>Nome: </label><div class="">{{ user_form.first_name }}</div></div><div class="form-group"><label>Sobrenome: </label><div class="">{{ user_form.last_name }}</div></div><div class="form-group"><label>Email: </label><div class="">{{ user_form.email }}</div></div><div class="form-group"><label>Nome de Usuário: </label><div class="">{{ user_form.username }}</div></div><div class="form-group"><label>Senha: </label><div class="">{{ user_form.password1 }}</div></div><div class="form-group"><label>Confirmação de Senha: </label><div class="">{{ user_form.password2 }}</div></div><div><button class="btn btn-info btn-fill pull-left" type="submit">Criar Usuário</button></div></p>')
	// 			document.getElementById('sim/não').value = 'não'
	// 		}
	// 		$('#pai').children('div').hide();
	// 		$('#pai').children('#'+selectValor).show();
	// 	});
	// });
</script>

{% endblock %}